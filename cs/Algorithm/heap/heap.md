# heap

## 父节点、左右子节点的索引

堆是一颗完全二叉树，在本例中，不影响推断，将堆扩展为一棵满二叉树。

记树顶的层数为$0$，根节点索引值为$0$。从空的堆开始，每插入一个节点，其索引值加1。

另记第$j$层从左往右各个节点的序号为$s_j=\{0,1,2,...,2^{j}-1\}$，第$j+1$层相应为$s_{j+1}=\{0,1,...,2^{j+1}-1\}$。

第${j}$层的第一个节点索引值为$2^{j}$，最后一个节点的索引值为$2^{j} - 1 + 2^j=2^{j+1}-1$。

因此得到第$j$层的所有节点的索引值从左往右依次为$\{2^{j}-1, 2^{j}, ..., 2^{j} + 2^{j} - 2\}$。

对应的$j+1$层的所有节点的索引值从左往右依次为$\{2^{j+1}-1, 2^{j+1},...,2^{j+1}+2^{j+1}-2\}$。

由于两层是二叉对应关系，因此第$j$层的序号为$s_j$的左右子节点的序号为$2s_j$和$2s_j+1$，同样的，第$j+1$层的序号为$s_{j+1}$的父节点为$\lfloor s_{j+1}/2 \rfloor$。

若第$j$层的某个节点的索引值为$i$，序号为$s$，有$i=2^j + s - 1$。（根据左右子节点序号的关系）因此其左右子节点的索引值分别为$i_{left}=2^{j+1}+2s-1$和$i_{right}=2^{j+1}+2s$，其父节点的索引值为$i_{parent} = 2^{j-1} -1+ \lfloor s/2 \rfloor$。

可以验证，$i_{left}=i*2+1$，$i_{right}=i*2+2$，$i_{parent} = \lfloor (i-1)/2 \rfloor$成立。