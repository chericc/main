# Advanced Programming in the UNIX Environment - Third Edition

## 第1章 UNIX基础知识

### 1.1 引言

本书集中阐述不同版本的UNIX操作系统所提供的服务。

### 1.2 UNIX体系结构

从严格意义上说，可将操作系统定义为一种软件，它控制计算机硬件资源，提供程序运行环境。我们通常将这种软件称为内核。

从广义上说，操作系统包括了内核和一些其它软件，包括系统实用程序、应用程序、shell以及公用函数库等。

### 1.3 登陆

#### 1.3.1 登陆名

用户在登陆UNIX系统时，先键入登陆名，然后键入口令。系统在其口令文件（/etc/passwd )中查看登陆名。

#### 1.3.2 shell

用户登陆后，系统通常先显示一些系统信息，然后用户就可以向shell程序键入命令。shell是一个命令行解释器，它读取用户输入，然后执行命令。

### 1.4 文件和目录

#### 1.4.1 文件系统

UNIX文件系统是目录和文件的一种层次结构，所有东西的起点是称为根的目录，这个目录的名称是一个字符“/”。

#### 1.4.2 文件名

目录中的各个名字称为文件名。只有斜线和空字符不能出现在文件名中，斜线用来分隔构成路径名的各文件名，空字符则用来终止一个路径名。

#### 1.4.3 路径名

由斜线分隔的一个或多个文件名组成的序列构成路径名，以斜线开头的称为绝对路径名，否则称为相对路径名。相对路径名只想相对于当前目录的文件。

#### 1.4.4 工作目录

每个进程都有一个工作目录，有时称其为当前工作目录。所有相对路径名都从工作目录开始解释。进程可以用chdir函数更改其工作目录。

#### 1.4.5 起始目录

登陆时，工作目录设置为起始目录（home directory），该起始目录从口令文件中相应用户的登陆项中取得。

### 1.5 输入和输出

#### 1.5.1 文件描述符

文件描述符通常是一个小的非负整数，内核用以标识一个特定进程正在访问的文件。

#### 1.5.2 标准输入、标准输出和标准错误

按惯例，每当运行一个新程序，所有的shell都为其打开3个文件描述符，即标准输入、标准输出以及标准错误。如果不做特殊处理，这三个描述符都链接向终端。

#### 1.5.3 不带缓冲的IO

略

#### 1.5.4 标准IO

略

### 1.6 程序和进程

#### 1.6.1 程序

程序是一个存储在磁盘上某个目录中的可执行文件。内核使用exec函数将程序读入内存，并执行程序。

#### 1.6.2 进程和进程ID

程序的执行实例被称为进程。UNIX系统确保每个进程都有一个唯一的数字标识符，称为进程ID，进程ID总是一个非负整数。

#### 1.6.3 进程控制

有3个用户进程控制的函数：fork、exec和waitpid。

#### 1.6.4 线程和线程ID

和进程相同，线程也用ID标识。但是，线程ID只在它所属的进程内起作用。

控制线程和函数与控制进程的函数类似，但另有一套。线程模型是在进程模型建立很久之后才被引入UNIX系统中的，然而这两种模型之间存在复杂的交互。

### 1.7 出错处理

当UNIX系统函数出错时，通常会返回一个负值，而且整型变量errno通常被设置为具有特定信息的值。而有些函数对于出错则使用另外一种约定而不是返回负值。