# Computer Graphics Programming in OPENGL with C++(Second Edition)

## 第1章 入门

图形编程是计算机科学中最具挑战性的主题之一，并因此而闻名。当今，图形编程是基于着色器的。有些程序是用诸如C++或Java的等标准编程语言编写的，并运行在中央处理器上；另一些是用专用的着色器语言编写的，直接运行在图形处理单元上。着色器编程的学习曲线很陡峭，以致哪怕是绘制简单的东西，也需要一系列错综复杂的步骤，把图形数据从一个管线中传递下去才能完成。现代显卡能够并行处理数据，即使是挥之简单的形状，图形程序员也必须理解GPU的并行架构。

这虽然并不简单，但可以换回超强的渲染能力。

### 1.1 语言和库

总的来说，需要用到以下库：

- C++开发环境；
- OpenGL/GLSL；
- 窗口管理库
- 扩展库
- 数学库
- 纹理图像加载库

#### 1.1.1 C++

本书使用visual studio。

#### 1.1.2 OpenGL/GLSL

本书假定读者的计算机上有一个支持至少4.3版本OpenGL的显卡。

#### 1.1.3 窗口管理库

OpenGL实际上并不是把图像直接绘制到计算机屏幕上，而是将之渲染到一个帧缓冲区，然后由计算机来负责把帧缓冲区中的内容绘制到屏幕上的一个窗口中。

GLFW是本书选择使用的窗口管理库。

#### 1.1.4 扩展库

OpenGL围绕一组基本功能和扩展机制进行组织。随着技术的发展，扩展机制可以用来支持新的功能。OpenGL的核心中有一些内置的命令用来支持这一点，但是为了使用现代命令，需要执行很多相当复杂的代码。使用一个扩展库来处理这些细节已经成了标准做法，这样能让程序员直接使用现代OpenGL命令。扩展库有Glee、GLLoader和GLEW，以及新版的GL3W和GLAD。本书使用GLEW。

#### 1.1.5 数学库

3D图形编程会大量使用向量和矩阵代数。因此，配合一个支持常见数学计算任务的函数库或者类包，能极大地方便OpenGL的使用。

本书使用OpenGL Mathematics数学库，一般称作GLM。

GLM可提供与图形概念相关的类和基本数学函数，例如矢量、矩阵和四元数。它还包含各种工具类，用于创建和使用常见的3D图形结构，例如透视和视角矩阵。

#### 1.1.6 纹理图像加载库

从第5章开始，我们将使用图形文件来向图形场景中的对象添加纹理。这意味着我们会频繁加载这些图像文件到我们的C++/OpenGL代码中。

本书使用的纹理图像加载库是SOIL2，SOIL的一个更新的分支版本。

#### 1.1.7 可选库

本书中，我们将展示如何从零开始实现一个简单的OBJ模型加载器。然而，它没有处理OBJ标准中很多可用的选项。有一些更复杂的、现成的OBJ模型加载器可供选择，比如Assimp和tinyobjloader。

## 第2章 OpenGL图像管线

OpenGL是整合软硬件的多平台2D和3D图形API。

在硬件方面，OpenGL提供了一个多级图形管线，可以使用一种名为GLSL的语言进行部分编程。

在软件方面，OpenGL的API是用C语言编写的，因此API调用直接兼容C和C++。对于其他的流行语言，OpenGL也有稳定的包装库，它们具有与C语言库几乎相同的性能。当一个C++程序包含OpenGL调用时，我们将其称为C++/OpenGL应用程序。C++/OpenGL应用程序的一个重要任务是让程序员的GLSL代码运行于GPU上。

基于C++的图形应用概览如下图所示。

![](assets/2_1.svg)

在后面的编码中，一部分用C++实现，进行OpenGL调用；另一部分用GLSL实现。C++/OpenGL应用程序、GLSL模块和硬件一起用来生成3D图形输出。当应用程序完成之后，最终用户直接与C++应用程序交互。

GLSL是一种着色器语言。着色器语言主要运行于GPU上。GLSL是与OpenGL兼容的专用着色器语言。

### 2.1 OpenGL管线

现代3D图形编程会使用管线的概念，在管线中，将3D场景转换为2D图形的过程被分割成许多步骤。下图为OpenGL图形管线简化后的概览。

![](assets/2_2.svg)

C++/OpenGL应用程序发送图形数据到顶点着色器，随着管线处理，最终生成在显示器上显示的像素点。

图中顶点着色器、曲面细分着色器、几何着色器、片段着色器可以用GLSL编程。将GLSL程序载入这些着色器阶段也是C++/OpenGL应用程序的责任之一。其过程如下：

（1）使用C++获取GLSL着色器代码，既可以从文件中读取，也可以硬编码在字符串中；

（2）创建OpenGL着色器对象，并将GLSL着色器代码加载到着色器对象中；

（3）用OpenGL命令编译并连接着色器对象，将它们装载到GPU；

实践中，一般至少要提供顶点着色器和片段着色器阶段的GLSL代码，而曲面细分着色器和几何着色器阶段是可省略的。

#### 2.1.1 C++/OpenGL应用程序

