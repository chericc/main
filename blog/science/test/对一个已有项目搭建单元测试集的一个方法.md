# 对一个已有项目搭建单元测试集的一个方法

## 1 软件环境

```
googletest
cmake
```

## 2 名词

### 2.1 mock

mock是指被测试程序依赖的一些外部对象。

项目中我们不通过名字来区分mock、stub、fake对象，统一用mock来表示。注意在编写外部依赖时，控制复杂度（角色不能过多，或者说单一依赖角色尽量单一）。

## 3 步骤

### 3.1 测试对象

一个测试集对应一个文件集中的模块。

一个测试集由多个对象组成。一个对象表示一个具体的功能，比如测试程序，mock库，工具库。测试程序是最终会运行的程序，通常由被测试的源代码、依赖库。

### 3.2 根目录

根目录的CMakeLists.txt给出整个测试集涉及的所有模块的相关定义。对于测试程序，给出测试程序的名字。对于依赖库，给出库的名字，库的源文件。

### 3.3 子目录

#### 3.3.1 对单个文件进行测试

创建一个和单个文件所在的路径完全一致的文件夹（这个文件夹就是测试这个文件的对应文件夹）。例如，被测试文件的路径为`a/b/c/func.cpp`，则创建文件夹为`a/b/c/func/`，然后在这个文件夹中创建`CMakeLists.txt`和对应的测试文件如`test_func.cpp`。

```bash
eg.

被测文件
project_path/a/b/c/func.cpp

测试文件夹
test_path/a/b/c/func/
test_path/a/b/c/func/CMakeLists.txt
test_path/a/b/c/func/test_func.cpp
```

测试文件夹中的CMakeLists.txt主要内容为：

- 要引入的头文件路径。
- 生成可执行文件，并给定对应的源文件。源文件通常包括测试文件、被测试文件、主函数文件。
- 链接库。除了被测对象外，依赖的对象均应作为MOCK对象提供（不要从被测项目中获取）。
- 添加本测试特定的编译选项（如宏定义）

#### 3.3.2 对一个目录进行测试

与单个文件相比，调整测试文件夹的路径如下：

```bash
eg.

被测文件夹
project_path/a/b/c/func/

测试文件夹
test_path/a/b/c/func/
test_path/a/b/c/func/CMakeLists.txt
test_path/a/b/c/func/test_func.cpp
```

